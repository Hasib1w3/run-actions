name: Keep Spaces Alive

on:
  schedule:
    - cron: "0 */10 * * *" # Every 10 hours
  workflow_dispatch:

jobs:
  ping_spaces:
    runs-on: ubuntu-latest
    steps:
      # --------------------------------------------------------------------------
      # STEP 1: Standard Health Checks (GET Requests) with AUTH
      # --------------------------------------------------------------------------
      - name: Check Health Endpoints (GET)
        env:
          # URL|TOKEN format
          URLS: >
            https://hasibxx2x-api.hf.space/health|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
            https://hasibxx2x-api1.hf.space/health|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
            https://hasibxx2x-api2.hf.space/health|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
            https://hasibxx2x-api3.hf.space/health|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
            https://hasibxx2x-api4.hf.space/health|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
            https://hasibxx2x-api5.hf.space/health|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
            https://hasibxx2x-api6.hf.space/health|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
            https://hasibxx2x-api7.hf.space/health|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
            https://hasibxx2x-api8.hf.space/health|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
            https://tbhrtgjnr-api.hf.space/health|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
            https://tbhrtgjnr-api1.hf.space/health|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
            https://tbhrtgjnr-api2.hf.space/health|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
            https://tbhrtgjnr-api3.hf.space/health|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
            https://tbhrtgjnr-api4.hf.space/health|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
            https://tbhrtgjnr-api5.hf.space/health|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
            https://tbhrtgjnr-api6.hf.space/health|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
            https://tbhrtgjnr-api7.hf.space/health|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
            https://tbhrtgjnr-api8.hf.space/health|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
            https://bdfbefbh-gemini.hf.space/health|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
            https://bdfbefbh-gemini1.hf.space/health|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
            https://bdfbefbh-gemini2.hf.space/health|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
            https://bdfbefbh-gemini3.hf.space/health|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
            https://bdfbefbh-gemini4.hf.space/health|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
            https://bdfbefbh-gemini5.hf.space/health|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
            https://bdfbefbh-gemini6.hf.space/health|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
            https://bdfbefbh-gemini7.hf.space/health|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
            https://bdfbefbh-gemini8.hf.space/health|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
            https://htyjy6-siteclone.hf.space/health|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
            https://htyjy6-siteclone1.hf.space/health|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
            https://htyjy6-siteclone2.hf.space/health|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
            https://htyjy6-siteclone3.hf.space/health|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
            https://htyjy6-siteclone4.hf.space/health|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
            https://htyjy6-siteclone5.hf.space/health|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
            https://htyjy6-siteclone6.hf.space/health|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
            https://htyjy6-siteclone7.hf.space/health|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
            https://htyjy6-siteclone8.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration1.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration2.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration3.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration4.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration5.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration6.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration7.hf.space/health|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
            https://muhammadshahalamsheikh-inspiration8.hf.space/health|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
        run: |
          echo "Starting health checks..."
          error_found=0
          
          for entry in $URLS; do
            # Split entry into URL and TOKEN using '|' delimiter
            url="${entry%|*}"
            token="${entry#*|}"

            echo "Target: $url"
            STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
              --max-time 10 \
              -H "Authorization: Bearer $token" \
              "$url")
            
            if [ "$STATUS_CODE" -eq 200 ]; then
              echo "‚úÖ Success (Status: 200)"
            else
              echo "‚ùå Failed (Status: $STATUS_CODE)"
              # Optional: Don't error out entire workflow for just one fail,
              # just mark variable
              error_found=1
            fi
            echo "----------------------------------------"
          done

      # --------------------------------------------------------------------------
      # STEP 2: POST Requests (Generations/Actions) with AUTH & LOGGING
      # --------------------------------------------------------------------------
      - name: Run POST Generators
        env:
          POST_CONFIG: |
            https://bdfbefbh-gemini.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini1.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini2.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini3.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini4.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini5.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini6.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini7.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            https://bdfbefbh-gemini8.hf.space/generate|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
            {
              "user_prompt": "hi",
              "system_prompt": "helpful assistant",
              "config": "auto"
            }
            
        run: |
          echo "Starting POST requests..."
          
          CURRENT_URL=""
          CURRENT_TOKEN=""
          JSON_BUFFER=""
          ERROR_FOUND=0
          
          execute_post() {
            if [ -n "$CURRENT_URL" ]; then
              echo "üëâ Triggering: $CURRENT_URL"
              
              # Save JSON payload to file
              echo "$JSON_BUFFER" > post_body.json
              
              # Clear previous response file
              echo "" > response.txt
              
              # Execute Curl with Auth
              STATUS_CODE=$(curl -s -o response.txt -w "%{http_code}" \
                -H "Content-Type: application/json" \
                -H "Authorization: Bearer $CURRENT_TOKEN" \
                -X POST \
                -d @post_body.json \
                --max-time 480 \
                "$CURRENT_URL")

              if [ "$STATUS_CODE" -eq 200 ]; then
                echo "‚úÖ Request finished (Status: 200)"
                echo "üìÑ API RESPONSE:"
                echo "----------------------------------------"
                cat response.txt
                echo ""
                echo "----------------------------------------"
              else
                echo "‚ùå Request failed (Status: $STATUS_CODE)"
                echo "üìÑ ERROR DETAILS:"
                cat response.txt
                ERROR_FOUND=1
              fi
            fi
          }

          # Read config line by line
          while IFS= read -r line || [ -n "$line" ]; do
            clean_line=$(echo "$line" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
            
            if [ -z "$clean_line" ]; then continue; fi

            if [[ "$clean_line" == http* ]]; then
              execute_post
              
              # Split line into URL and TOKEN
              CURRENT_URL="${clean_line%|*}"
              CURRENT_TOKEN="${clean_line#*|}"
              
              JSON_BUFFER=""
            else
              JSON_BUFFER+="$line "
            fi
          done <<< "$POST_CONFIG"

          # Execute final request
          execute_post

          if [ $ERROR_FOUND -eq 1 ]; then
            echo "‚ö†Ô∏è Some POST requests failed."
            exit 1
          else
            echo "üéâ All requests completed successfully."
          fi
